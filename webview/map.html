<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpYGb8BVSnp_5KgwqPgZbsVnRWfT8NS5I"></script>
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<style type="text/css">
		html, body {
			height: 100%;
			font-family: sans-serif;
		}
		#map {
			height: 50%;
			width: 100%;
		}
		#info-panel {
			height: 50%;
			width: 100%;
			background-color: #A9A9A9;
		}
		.info-row {
			margin-bottom: 3.5vh;
		}
		.info-description {
			font-size: 4vh; /*Calculated as a fraction of the overall webview*/
		}
		#distance, #eta {
			background-color: gray;
			color: white;
			padding: 1%;
			border: 2px solid black;
			border-radius: 4px;
		}
	</style>
</head>
<body>
	<div id="map"></div>
	<div id="info-panel">
		<div style="padding-left: 5%; padding-top: 5%;">
			<div class="info-row">
				<span class="info-description">Distance to Station: </span><span id="distance" class="info-description"></span>
			</div>
			<div class="info-row">
				<span class="info-description">Estimated Travel Time: </span><span id="eta" class="info-description"></span>
			</div>
		</div>
		<div class="train-panel">
			<div>
				<div>
					<span id="train-name"></span>
					<div id="train-color"></div>
					<span id="train-eta"></span>
				</div>
				<div>
					<span id="platform"></span>
					<span id="car-number"></span>
					<span id="bike-friendly"></span>
				</div>
			</div>	
		</div>
	</div>

	<script type="text/javascript">
		var distanceService = new google.maps.DistanceMatrixService;
		var directionsService = new google.maps.DirectionsService();
		var directionsDisplay = new google.maps.DirectionsRenderer();
		var distance;
		var travelTime;
		var message;
    
		function initMap() {
			var mapOptions = {
				zoom: 10,
				center:  {lat: 37.75, lng: -122.3},
				disableDefaultUI: true
			}
			var map = new google.maps.Map(document.getElementById('map'), mapOptions);
			directionsDisplay.setMap(map);
		}

		function calcRoute(directionsService, directionsDisplay) {
			directionsService.route({
			    origin: clientLocation,
			    destination: targetStation + " bart station",
			    travelMode: currentTransportation.toUpperCase()
			  }, function(response, status) {
			    if (status === 'OK') {
			      directionsDisplay.setDirections(response);
			    } else {
			      // window.alert('Directions request failed due to ' + status);
			      console.log('Directions request failed due to ' + status);
			    }
			  });
		}

		function getDistanceToStationsFromClient(targetStation) {
			distanceService.getDistanceMatrix({
				origins: [clientLocation],
				destinations: [targetStation + " bart station"],
				travelMode: currentTransportation.toUpperCase(),
				unitSystem: google.maps.UnitSystem.IMPERIAL,
			}, function (response, status) {
				if (status === 'OK') {
					distance = response.rows[0].elements[0].distance.text;
					travelTime = response.rows[0].elements[0].duration.text;
					document.getElementById("distance").innerHTML = distance;
					document.getElementById("eta").innerHTML = travelTime;
				} else {
					console.log('Error was: ' + status);
				}
			});
		}

		initMap();
		calcRoute(directionsService, directionsDisplay);
		getDistanceToStationsFromClient(targetStation);
	
		
		

		

		
		// to determine a rough chance of being able to catch the selected train
		// if (travelTimeInt > selectedTrain.eta + 1) {
		// 	chance = "low";
		// 	$("#estimatedChance").html(
		// 		'Chance of catching this train: <span class="chance" id=' + chance + '>LOW</span>');
		// }
		// else if (travelTimeInt >= selectedTrain.eta - 1) {
		// 	chance = "medium";
		// 	$("#estimatedChance").html(
		// 		'Catch it? <span class="chance" id=' + chance + '>cutting it close...</span>');
		// }
		// else {
		// 	chance = "high";
		// 	$("#estimatedChance").html(
		// 		'Chance of catching this train: <span class="chance" id=' + chance + '>high</span>');
		// }
	</script>
</body>
</html>